{{- define "main" }}

{{- if .Title }}
<header class="page-header">
    <h1>{{ .Title }}</h1>
    {{- if .Description }}
    <div class="post-description">
        {{ .Description }}
    </div>
    {{- end }}
</header>
{{- end }}

{{/* è·å–åˆ†ç±»æ•°æ® */}}
{{- $taxonomies := .Site.Taxonomies.categories }}

{{/* åˆå§‹åŒ–åˆ†ç±»æè¿°å­˜å‚¨ */}}
{{- $.Scratch.Set "categoryDescriptions" dict }}

{{/* è§£æ Markdown å†…å®¹ï¼Œæå–åˆ†ç±»å’Œæè¿° */}}
{{- $lines := split .Content "\n" }}
{{- $currentCategory := "" }}

{{/* æ‰«ææ¯ä¸€è¡Œï¼ŒæŸ¥æ‰¾åˆ†ç±»å’Œæè¿° */}}
{{- range $lines }}
    {{/* æ£€æŸ¥æ˜¯å¦æ˜¯äºŒçº§æ ‡é¢˜è¡Œ */}}
    {{- if hasPrefix (trim . " ") "## " }}
        {{- $currentCategory = trim (replace . "## " "") " " }}
    {{/* æ£€æŸ¥æ˜¯å¦æ˜¯æè¿°è¡Œï¼ˆä»¥ > å¼€å¤´ï¼‰ */}}
    {{- else if and (hasPrefix (trim . " ") ">") $currentCategory }}
        {{- $description := trim (replace (trim . " ") ">" "") " " }}
        {{- $.Scratch.SetInMap "categoryDescriptions" $currentCategory $description }}
    {{- end }}
{{- end }}
{{- range $lines }}
    {{- if hasPrefix . "## " }}
        {{- $categoryName := trim (trim . "#") " " }}
        {{- $categories = $categories | append $categoryName }}
    {{- end }}
{{- end }}

{{- if gt (len $taxonomies) 0 }}
    <div class="categories-container">
        {{- range $name, $taxonomy := $taxonomies }}
            {{/* è·å–åˆ†ç±»æè¿° */}}
            {{- $descriptions := $.Scratch.Get "categoryDescriptions" }}
            {{- $description := index $descriptions $name }}
            <div class="category-card">
                <a href="{{ "/categories/" | relLangURL }}{{ $name | urlize }}">
                    <div class="category-content">
                        <div class="category-header">
                            <span class="category-name">{{- $name -}}</span>
                            <span class="category-count">{{- .Count -}}</span>
                        </div>
                        <div class="category-description">
                            {{- if $description }}
                                {{- $description }}
                            {{- else }}
                                åˆ†ç±»ä¸‹çš„æ–‡ç« é›†åˆ
                            {{- end }}
                        </div>
                    </div>
                </a>
            </div>
        {{- end }}
    </div>
{{- else }}
    <div class="terms-tags-empty">
        <p>æš‚æ—¶è¿˜æ²¡æœ‰åˆ†ç±»å“¦~ åˆ†ç±»ä¼šéšç€æ–‡ç« çš„å‘å¸ƒé€æ¸å¢åŠ  ğŸ“</p>
        <p>æ•¬è¯·æœŸå¾…ä¸‹ä¸€ç¯‡æ–‡ç« ï¼âœ¨</p>
    </div>
{{- end }}

{{- end }}{{/* end main */ -}}